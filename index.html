<!DOCTYPE html>

<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>Onze Agenda â€“ Rob &amp; Lizet</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <style>
    :root {
      --bg:          #fdf8ee;
      --surface:     #f5edda;
      --card:        #ede0c4;
      --rob:         #1a5fa8;
      --rob-bg:      rgba(26,95,168,.08);
      --rob-bd:      rgba(26,95,168,.30);
      --lizet:       #8b5e3c;
      --lizet-bg:    rgba(139,94,60,.08);
      --lizet-bd:    rgba(139,94,60,.30);
      --beide:       #3a6b4a;
      --beide-bg:    rgba(58,107,74,.08);
      --beide-bd:    rgba(58,107,74,.30);
      --bday:        #b45309;
      --bday-bg:     rgba(180,83,9,.08);
      --bday-bd:     rgba(180,83,9,.30);
      --mem:         #6b4fa8;
      --mem-bg:      rgba(107,79,168,.08);
      --mem-bd:      rgba(107,79,168,.30);
      --text:        #1c1917;
      --muted:       #78716c;
      --border:      rgba(0,0,0,.10);
      --green:       #2d7a46;
      --yellow:      #b45309;
      --red:         #dc2626;
      --shadow:      rgba(0,0,0,.07);
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    html,body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;-webkit-tap-highlight-color:transparent;}
    #app{max-width:720px;margin:0 auto;padding:36px 20px 80px;}

```
/* sync */
#sync-bar{display:none;align-items:center;gap:10px;background:var(--beide-bg);border:1px solid var(--beide-bd);border-radius:12px;padding:10px 14px;margin-bottom:20px;font-size:.82rem;color:var(--beide);}
#sync-bar.error{background:rgba(220,38,38,.07);border-color:rgba(220,38,38,.25);color:var(--red);}
.sync-dot{width:8px;height:8px;border-radius:50%;background:var(--beide);flex-shrink:0;animation:pulse 2s infinite;}
#sync-bar.error .sync-dot{background:var(--red);animation:none;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.35}}

/* notif */
#notif-banner{display:none;align-items:center;gap:12px;background:var(--rob-bg);border:1px solid var(--rob-bd);border-radius:14px;padding:14px 16px;margin-bottom:28px;}
#notif-banner p{flex:1;font-size:.83rem;line-height:1.45;}
#notif-banner p strong{display:block;margin-bottom:2px;color:var(--rob);}
#notif-allow-btn{background:var(--rob-bg);border:1px solid var(--rob-bd);color:var(--rob);border-radius:8px;padding:8px 14px;font-family:'DM Sans',sans-serif;font-size:.82rem;font-weight:600;cursor:pointer;white-space:nowrap;flex-shrink:0;}
#notif-dismiss{background:none;border:none;color:var(--muted);cursor:pointer;font-size:1.1rem;flex-shrink:0;}

/* toast */
#toast{display:none;position:fixed;top:20px;left:50%;transform:translateX(-50%);background:var(--text);border-radius:12px;padding:12px 20px;font-size:.85rem;color:var(--bg);box-shadow:0 8px 32px rgba(0,0,0,.18);z-index:999;white-space:nowrap;animation:toastIn .3s ease;}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(-8px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

/* header */
.header{text-align:center;margin-bottom:40px;}
.header h1{font-family:'Playfair Display',serif;font-size:2.6rem;background:linear-gradient(135deg,var(--rob),var(--lizet));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:10px;}
.header-names{display:flex;justify-content:center;gap:14px;margin-bottom:8px;}
.name-pill{padding:4px 16px;border-radius:20px;font-size:.8rem;font-weight:600;}
.name-pill.rob{background:var(--rob-bg);border:1px solid var(--rob-bd);color:var(--rob);}
.name-pill.lizet{background:var(--lizet-bg);border:1px solid var(--lizet-bd);color:var(--lizet);}
.header p{color:var(--muted);font-size:.85rem;font-weight:300;}

/* mic */
.mic-section{display:flex;flex-direction:column;align-items:center;gap:18px;margin-bottom:36px;}
.mic-ring{position:relative;width:100px;height:100px;flex-shrink:0;}
.mic-ring::before{content:'';position:absolute;inset:-6px;border-radius:50%;background:conic-gradient(var(--rob),var(--lizet),var(--rob));opacity:0;transition:opacity .4s;}
.mic-ring.listening::before{opacity:1;animation:ringRot 2s linear infinite;}
.mic-ring::after{content:'';position:absolute;inset:-3px;border-radius:50%;background:var(--bg);opacity:0;transition:opacity .4s;}
.mic-ring.listening::after{opacity:1;}
@keyframes ringRot{from{transform:rotate(0)}to{transform:rotate(360deg)}}
#mic-btn{position:relative;z-index:1;width:100px;height:100px;border-radius:50%;border:2px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:2rem;background:var(--surface);box-shadow:0 2px 12px var(--shadow);transition:all .3s;-webkit-appearance:none;}
#mic-btn.active{background:linear-gradient(135deg,var(--rob-bg),var(--lizet-bg));border-color:transparent;}
#mic-btn.busy{background:var(--beide-bg);border-color:var(--beide);animation:spinGlow 1.5s infinite;}
@keyframes spinGlow{0%,100%{box-shadow:0 0 20px rgba(58,107,74,.2)}50%{box-shadow:0 0 40px rgba(58,107,74,.4)}}
#status-text{font-size:.85rem;color:var(--muted);text-align:center;min-height:20px;}
#status-text.active{color:var(--rob);}
#status-text.processing{color:var(--beide);}
#transcript-box{display:none;width:100%;background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px 18px;font-size:.93rem;font-style:italic;line-height:1.5;}
.alert{display:none;width:100%;border-radius:12px;padding:13px 16px;font-size:.83rem;line-height:1.55;}
.alert.error{background:rgba(220,38,38,.07);border:1px solid rgba(220,38,38,.2);color:var(--red);text-align:center;}
.alert.warn{background:rgba(180,83,9,.07);border:1px solid rgba(180,83,9,.2);color:var(--yellow);}
.alert.warn strong{font-weight:600;display:block;margin-bottom:4px;}

/* text input */
#text-section{display:none;width:100%;flex-direction:column;gap:10px;}
#text-section.visible{display:flex;animation:slideIn .3s ease;}
#text-hint{font-size:.8rem;color:var(--muted);text-align:center;}
.text-row{display:flex;gap:8px;}
#text-input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 16px;font-family:'DM Sans',sans-serif;font-size:.95rem;color:var(--text);outline:none;-webkit-appearance:none;}
#text-input::placeholder{color:var(--muted);}
#text-input:focus{border-color:var(--rob);}
#text-submit{background:var(--rob-bg);border:1px solid var(--rob-bd);color:var(--rob);border-radius:12px;padding:12px 18px;font-family:'DM Sans',sans-serif;font-size:1.1rem;cursor:pointer;flex-shrink:0;}
#text-submit:disabled{opacity:.4;cursor:not-allowed;}
.mode-toggle{font-size:.78rem;color:var(--muted);cursor:pointer;text-decoration:underline;text-underline-offset:3px;background:none;border:none;font-family:'DM Sans',sans-serif;padding:0;}

/* scan */
.scan-section{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:4px;}
#scan-btn{display:flex;align-items:center;gap:8px;background:var(--lizet-bg);border:1px solid var(--lizet-bd);color:var(--lizet);border-radius:12px;padding:10px 20px;font-family:'DM Sans',sans-serif;font-size:.88rem;font-weight:600;cursor:pointer;transition:all .2s;-webkit-appearance:none;}
#scan-btn:disabled{opacity:.4;cursor:not-allowed;}
#scan-label{font-size:.75rem;color:var(--muted);text-align:center;}
#camera-input{display:none;}
#scan-preview{display:none;width:100%;flex-direction:column;align-items:center;gap:12px;}
#scan-preview.visible{display:flex;animation:slideIn .3s ease;}
#preview-img{max-width:100%;max-height:200px;border-radius:12px;border:2px solid var(--lizet-bd);object-fit:contain;}
#scan-status{font-size:.82rem;color:var(--muted);text-align:center;}
#scan-status.scanning{color:var(--lizet);}

/* tabs */
.tabs{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;margin-bottom:16px;background:var(--surface);border-radius:14px;padding:5px;border:1px solid var(--border);box-shadow:0 1px 4px var(--shadow);}
.tab{padding:9px 4px;border:1px solid transparent;border-radius:10px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:500;background:transparent;color:var(--muted);transition:all .22s;text-align:center;}
.tab[data-tab="alle"].active{background:var(--bg);color:var(--text);border-color:var(--border);box-shadow:0 1px 4px var(--shadow);}
.tab[data-tab="rob"].active{background:var(--rob-bg);color:var(--rob);border-color:var(--rob-bd);}
.tab[data-tab="lizet"].active{background:var(--lizet-bg);color:var(--lizet);border-color:var(--lizet-bd);}
.tab[data-tab="bday"].active{background:var(--bday-bg);color:var(--bday);border-color:var(--bday-bd);}
.tab[data-tab="mem"].active{background:var(--mem-bg);color:var(--mem);border-color:var(--mem-bd);}

/* search */
#search-wrap{position:relative;margin-bottom:16px;}
#search-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:11px 38px 11px 40px;font-family:'DM Sans',sans-serif;font-size:.9rem;color:var(--text);outline:none;-webkit-appearance:none;box-shadow:0 1px 4px var(--shadow);}
#search-input::placeholder{color:var(--muted);}
#search-input:focus{border-color:var(--rob);}
#search-icon{position:absolute;left:13px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:.95rem;pointer-events:none;}
#search-clear{display:none;position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--muted);cursor:pointer;font-size:.85rem;padding:4px 6px;border-radius:6px;}
#search-count{display:none;font-size:.75rem;color:var(--muted);text-align:right;margin-top:-10px;margin-bottom:10px;}
mark{background:rgba(180,83,9,.20);color:var(--text);border-radius:2px;padding:0 2px;font-weight:600;}

/* export bar */
#export-bar{display:none;align-items:center;justify-content:space-between;gap:12px;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 16px;margin-bottom:16px;box-shadow:0 1px 4px var(--shadow);}
#export-bar p{font-size:.82rem;color:var(--muted);line-height:1.4;}
#export-all-btn{background:var(--rob-bg);border:1px solid var(--rob-bd);color:var(--rob);border-radius:8px;padding:8px 14px;font-family:'DM Sans',sans-serif;font-size:.82rem;font-weight:600;cursor:pointer;white-space:nowrap;flex-shrink:0;}

/* cards */
#apt-list{display:flex;flex-direction:column;gap:8px;}
.section-title{font-size:.78rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--muted);margin:24px 0 10px;display:flex;align-items:center;gap:10px;}
.section-title::after{content:'';flex:1;height:1px;background:var(--border);}
.count-badge{background:var(--card);border-radius:20px;padding:1px 9px;font-size:.75rem;font-weight:600;color:var(--muted);}
.apt-card{border-radius:14px;padding:16px 18px;display:flex;align-items:flex-start;gap:14px;border:1px solid;transition:transform .2s,box-shadow .2s;animation:slideIn .3s ease;box-shadow:0 2px 8px var(--shadow);}
.apt-card:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.10);}
.apt-card.rob{background:#eaf0fb;border-color:var(--rob-bd);}
.apt-card.lizet{background:#fdf5e4;border-color:var(--lizet-bd);}
.apt-card.beide{background:#eaf5ec;border-color:var(--beide-bd);}
.apt-card.bday{background:#fff4e6;border-color:var(--bday-bd);}
.apt-card.mem{background:#f3f0fa;border-color:var(--mem-bd);}
@keyframes slideIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.apt-icon{font-size:1.3rem;flex-shrink:0;margin-top:2px;}
.apt-body{flex:1;min-width:0;}
.apt-who{font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;margin-bottom:4px;}
.apt-who.rob{color:var(--rob);}
.apt-who.lizet{color:var(--lizet);}
.apt-who.beide{color:var(--beide);}
.apt-who.bday{color:var(--bday);}
.apt-who.mem{color:var(--mem);}
.apt-desc{font-size:.975rem;font-weight:500;margin-bottom:6px;line-height:1.4;}
.apt-meta{font-size:.78rem;color:var(--muted);display:flex;gap:12px;flex-wrap:wrap;align-items:center;}
.yearly-badge{display:inline-flex;align-items:center;gap:3px;background:var(--bday-bg);border:1px solid var(--bday-bd);color:var(--bday);border-radius:20px;padding:1px 8px;font-size:.72rem;font-weight:600;}
.yearly-badge.mem{background:var(--mem-bg);border-color:var(--mem-bd);color:var(--mem);}
.reminder-badge{display:inline-flex;align-items:center;gap:4px;background:rgba(180,83,9,.10);border:1px solid rgba(180,83,9,.25);color:var(--yellow);border-radius:20px;padding:1px 8px;font-size:.72rem;font-weight:600;}
.apt-actions{display:flex;gap:4px;flex-shrink:0;align-items:flex-start;position:relative;}
.apt-cal-btn,.apt-del-btn,.apt-bell-btn{background:none;border:none;cursor:pointer;font-size:.95rem;padding:4px 6px;border-radius:6px;transition:all .2s;opacity:.3;color:var(--muted);}
.apt-card:hover .apt-cal-btn,.apt-card:hover .apt-del-btn,.apt-card:hover .apt-bell-btn{opacity:1;}
.apt-cal-btn:hover{background:var(--rob-bg);color:var(--rob);}
.apt-cal-btn.done{color:var(--green);opacity:1!important;}
.apt-del-btn:hover{background:rgba(220,38,38,.08);color:var(--red);}
.apt-bell-btn:hover{background:var(--bday-bg);color:var(--bday);}
.apt-bell-btn.set{color:var(--bday);opacity:1!important;}

/* popover */
.reminder-popover{display:none;position:absolute;top:calc(100% + 6px);right:0;background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:8px;z-index:100;min-width:200px;box-shadow:0 8px 24px rgba(0,0,0,.13);animation:slideIn .15s ease;}
.reminder-popover.open{display:block;}
.reminder-popover p{font-size:.75rem;color:var(--muted);padding:4px 8px 6px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;}
.reminder-opt{display:block;width:100%;text-align:left;background:none;border:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.85rem;padding:8px 10px;border-radius:8px;cursor:pointer;white-space:nowrap;}
.reminder-opt:hover{background:var(--surface);}
.reminder-opt.active{color:var(--yellow);background:rgba(180,83,9,.07);font-weight:600;}
.reminder-opt.cancel{color:var(--red);}
.reminder-opt.cancel:hover{background:rgba(220,38,38,.07);}

.empty-state{text-align:center;padding:60px 20px;color:var(--muted);}
.empty-state .icon{font-size:2.5rem;margin-bottom:12px;}
.empty-state p{font-size:.88rem;line-height:1.6;}
.footer{text-align:center;margin-top:56px;padding-top:20px;border-top:1px solid var(--border);font-size:.75rem;color:var(--muted);letter-spacing:.04em;}
.footer span{background:linear-gradient(90deg,var(--rob),var(--lizet));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;font-weight:600;}
```

  </style>
</head>
<body>
<div id="app">

  <div id="sync-bar"><div class="sync-dot"></div><span id="sync-text">Verbonden</span></div>

  <div id="notif-banner">
    <p><strong>&#128276; Meldingen inschakelen</strong>Ontvang herinneringen voor je afspraken.</p>
    <button id="notif-allow-btn">Toestaan</button>
    <button id="notif-dismiss">&#10005;</button>
  </div>

  <div class="header">
    <h1>Onze Agenda</h1>
    <div class="header-names">
      <span class="name-pill rob">&#128100; Rob</span>
      <span class="name-pill lizet">&#128105; Lizet</span>
    </div>
    <p>Spreek, typ of scan je afspraken in</p>
  </div>

  <div class="mic-section">
    <div class="mic-ring" id="mic-ring">
      <button id="mic-btn">&#127897;&#65039;</button>
    </div>
    <div id="status-text">Tik de microfoon om een afspraak in te spreken</div>
    <div id="transcript-box"></div>
    <div class="alert warn" id="alert-blocked">
      <strong>&#128274; Microfoon geblokkeerd</strong>
      Ga naar Instellingen &#8594; Safari &#8594; Microfoon &#8594; Toestaan, herlaad de pagina.
    </div>
    <div class="alert error" id="alert-error"></div>

```
<div class="scan-section">
  <button id="scan-btn">&#128247; Scan afsprakenbrief</button>
  <div id="scan-label">Maak een foto van een brief, uitnodiging of kaart</div>
  <input id="camera-input" type="file" accept="image/*" capture="camera" />
</div>
<div id="scan-preview">
  <img id="preview-img" src="" alt="Scan" />
  <div id="scan-status">Wordt gelezen&hellip;</div>
  <div class="alert error" id="alert-scan-error"></div>
</div>

<div id="text-section">
  <div id="text-hint">Typ je afspraak, verjaardag of herdenking</div>
  <div class="text-row">
    <input id="text-input" type="text" placeholder="Bv. tandarts Rob 3 maart 14:00 of verjaardag mama 12 april" autocomplete="off" />
    <button id="text-submit">&#10133;</button>
  </div>
  <div class="alert error" id="alert-text-error"></div>
</div>
<button class="mode-toggle" id="mode-toggle">&#9000;&#65039; Liever typen? Gebruik tekstinvoer</button>
```

  </div>

  <div class="tabs">
    <button class="tab active" data-tab="alle">&#128467;<br>Alle <span id="count-alle"></span></button>
    <button class="tab" data-tab="rob">&#128100;<br>Rob <span id="count-rob"></span></button>
    <button class="tab" data-tab="lizet">&#128105;<br>Lizet <span id="count-lizet"></span></button>
    <button class="tab" data-tab="bday">&#127874;<br>Jarig <span id="count-bday"></span></button>
    <button class="tab" data-tab="mem">&#129559;<br>Herdenkingen <span id="count-mem"></span></button>
  </div>

  <div id="search-wrap">
    <span id="search-icon">&#128269;</span>
    <input id="search-input" type="search" placeholder="Zoeken in afspraken..." autocomplete="off" />
    <button id="search-clear">&#10005;</button>
  </div>
  <div id="search-count"></div>

  <div id="export-bar">
    <p>&#128197; Exporteer als .ics â€” werkt met Apple Agenda, Google Agenda &amp; Outlook.</p>
    <button id="export-all-btn">Alles exporteren</button>
  </div>

  <div id="apt-list">
    <div class="empty-state"><div class="icon">&#128257;</div><p>Verbinden&hellip;</p></div>
  </div>

  <div id="toast"></div>
  <div class="footer"><span>Made by Rob Borghouts</span> &middot; 2026</div>
</div>
<script>
var firebaseConfig={apiKey:"AIzaSyDeGP5IIWaFoG4PuISUueeccexrZOIVwGY",authDomain:"agenda-roblizet.firebaseapp.com",databaseURL:"https://agenda-roblizet-default-rtdb.europe-west1.firebasedatabase.app",projectId:"agenda-roblizet",storageBucket:"agenda-roblizet.firebasestorage.app",messagingSenderId:"789902813974",appId:"1:789902813974:web:62231ad5f5f90b4a91fe37"};
firebase.initializeApp(firebaseConfig);
var db=firebase.database(),dbRef=db.ref("appointments");

var REMIND_KEY=â€œafspraken_remindersâ€,appointments=[],reminders={},timers={},activeTab=â€œalleâ€,searchQuery=â€â€,textMode=false,listening=false,processing=false,recognition=null,finalText=â€â€,exported={},openPopover=null;
try{reminders=JSON.parse(localStorage.getItem(REMIND_KEY))||{};}catch(e){}

var syncBar=document.getElementById(â€œsync-barâ€),syncText=document.getElementById(â€œsync-textâ€),notifBanner=document.getElementById(â€œnotif-bannerâ€),notifAllowBtn=document.getElementById(â€œnotif-allow-btnâ€),notifDismiss=document.getElementById(â€œnotif-dismissâ€),micRing=document.getElementById(â€œmic-ringâ€),micBtn=document.getElementById(â€œmic-btnâ€),statusText=document.getElementById(â€œstatus-textâ€),transcriptBox=document.getElementById(â€œtranscript-boxâ€),alertBlocked=document.getElementById(â€œalert-blockedâ€),alertError=document.getElementById(â€œalert-errorâ€),scanBtn=document.getElementById(â€œscan-btnâ€),cameraInput=document.getElementById(â€œcamera-inputâ€),scanPreview=document.getElementById(â€œscan-previewâ€),previewImg=document.getElementById(â€œpreview-imgâ€),scanStatus=document.getElementById(â€œscan-statusâ€),alertScanErr=document.getElementById(â€œalert-scan-errorâ€),textSection=document.getElementById(â€œtext-sectionâ€),textInput=document.getElementById(â€œtext-inputâ€),textSubmit=document.getElementById(â€œtext-submitâ€),alertTextErr=document.getElementById(â€œalert-text-errorâ€),modeToggle=document.getElementById(â€œmode-toggleâ€),searchInput=document.getElementById(â€œsearch-inputâ€),searchClear=document.getElementById(â€œsearch-clearâ€),searchCount=document.getElementById(â€œsearch-countâ€),aptList=document.getElementById(â€œapt-listâ€),exportBar=document.getElementById(â€œexport-barâ€),exportAllBtn=document.getElementById(â€œexport-all-btnâ€),toastEl=document.getElementById(â€œtoastâ€);

var MONTHS={januari:0,februari:1,maart:2,april:3,mei:4,juni:5,juli:6,augustus:7,september:8,oktober:9,november:10,december:11};

function saveReminders(){try{localStorage.setItem(REMIND_KEY,JSON.stringify(reminders));}catch(e){}}
function showAlert(el,msg){el.innerHTML=msg||â€â€;el.style.display=msg?â€œblockâ€:â€œnoneâ€;}
function clearAlerts(){showAlert(alertBlocked,â€â€);showAlert(alertError,â€â€);showAlert(alertTextErr,â€â€);showAlert(alertScanErr,â€â€);}
function escH(s){return String(s).replace(/&/g,â€&â€).replace(/</g,â€<â€).replace(/>/g,â€>â€).replace(/â€/g,â€"â€);}
function highlight(t,q){if(!q)return escH(t);return escH(t).replace(new RegExp(â€(â€+q.replace(/[.*+?^${}()|[]\]/g,â€\$&â€)+â€)â€,â€œgiâ€),â€<mark>$1</mark>â€);}
function aptSortKey(a){if(a.type===â€œverjaardagâ€||a.type===â€œherdenkingâ€){return a.dateISO?â€œ0000-â€+a.dateISO.slice(5):â€œ9999â€;}if(a.dateISO)return a.dateISO+â€œTâ€+(a.time?a.time.replace(â€:â€,â€â€):â€œ0000â€);return â€œ9999-99-99Tâ€+new Date(a.createdAt).getTime();}

var toastTimer=null;
function showToast(msg){toastEl.innerHTML=msg;toastEl.style.display=â€œblockâ€;if(toastTimer)clearTimeout(toastTimer);toastTimer=setTimeout(function(){toastEl.style.display=â€œnoneâ€;},4000);}

db.ref(â€.info/connectedâ€).on(â€œvalueâ€,function(snap){var ok=snap.val()===true;syncBar.style.display=â€œflexâ€;syncBar.className=ok?â€â€:â€œerrorâ€;syncText.textContent=ok?â€œVerbonden \u2014 afspraken worden gedeeld met Lizetâ€:â€œGeen verbinding \u2014 wordt gesynchroniseerd zodra je online bentâ€;});
dbRef.on(â€œvalueâ€,function(snap){var data=snap.val();appointments=data?Object.keys(data).map(function(k){var a=data[k];a.id=k;return a;}):[]; scheduleAllReminders();render();},function(err){syncBar.className=â€œerrorâ€;syncText.textContent=â€œFout: â€œ+err.message;});

function notifSupported(){return â€œNotificationâ€ in window;}
function checkNotifBanner(){if(!notifSupported())return;notifBanner.style.display=Notification.permission===â€œdefaultâ€?â€œflexâ€:â€œnoneâ€;}
function requestNotifPermission(){if(!notifSupported())return;Notification.requestPermission().then(function(r){notifBanner.style.display=â€œnoneâ€;if(r===â€œgrantedâ€){showToast(â€\u{1F514} Meldingen ingeschakeld!â€);scheduleAllReminders();render();}});}

function aptDateTime(apt){
if(!apt.dateISO)return null;
var d;
if(apt.type===â€œverjaardagâ€||apt.type===â€œherdenkingâ€){
var now=new Date(),yr=now.getFullYear();
d=new Date(yr+â€-â€+apt.dateISO.slice(5));
if(d<now)d=new Date((yr+1)+â€-â€+apt.dateISO.slice(5));
}else{d=new Date(apt.dateISO);}
if(apt.time){var p=apt.time.split(â€:â€);d.setHours(parseInt(p[0]),parseInt(p[1]),0,0);}else d.setHours(8,0,0,0);
return d;
}
function scheduleReminder(apt){var mins=reminders[apt.id];if(mins===undefined)return;if(!notifSupported()||Notification.permission!==â€œgrantedâ€)return;if(timers[apt.id]){clearTimeout(timers[apt.id]);delete timers[apt.id];}var dt=aptDateTime(apt);if(!dt)return;var delay=dt.getTime()-mins*60000-Date.now();if(delay<0)return;timers[apt.id]=setTimeout(function(){var who=apt.person===â€œbeideâ€?â€œRob & Lizetâ€:apt.person===â€œrobâ€?â€œRobâ€:â€œLizetâ€;try{new Notification((apt.type===â€œverjaardagâ€?â€\u{1F382} â€œ:apt.type===â€œherdenkingâ€?â€\u{1FAF7} â€œ:â€â€)+apt.description,{body:(apt.date||apt.dateISO)+(apt.time?â€ om â€œ+apt.time:â€â€)+â€ \u2022 â€œ+who});}catch(e){showToast(â€\u{1F514} â€œ+apt.description);}delete timers[apt.id];},delay);}
function scheduleAllReminders(){appointments.forEach(function(a){if(reminders[a.id]!==undefined)scheduleReminder(a);});}
function cancelReminder(id){if(timers[id]){clearTimeout(timers[id]);delete timers[id];}delete reminders[id];saveReminders();}
function setReminder(apt,mins){reminders[apt.id]=mins;saveReminders();scheduleReminder(apt);}
var REM_OPTS=[{label:â€œ15 minuten van tevorenâ€,mins:15},{label:â€œ1 uur van tevorenâ€,mins:60},{label:â€œOchtend van de dagâ€,mins:480},{label:â€œ1 dag van tevorenâ€,mins:1440},{label:â€œ1 week van tevorenâ€,mins:10080}];
function remLabel(mins){var o=REM_OPTS.find(function(x){return x.mins===mins;});return o?o.label:mins+â€ minâ€;}

function parseFallback(text){
var lower=text.toLowerCase(),person=â€œbeideâ€;
if(lower.includes(â€œlizetâ€)&&!lower.includes(â€œrobâ€))person=â€œlizetâ€;
else if(lower.includes(â€œrobâ€)&&!lower.includes(â€œlizetâ€))person=â€œrobâ€;
var type=â€œafspraakâ€;
if(lower.includes(â€œverjaardagâ€)||lower.includes(â€œjarigâ€))type=â€œverjaardagâ€;
else if(lower.includes(â€œoverleedâ€)||lower.includes(â€œoverlijdenâ€)||lower.includes(â€œherdenkâ€)||lower.includes(â€œgestorvenâ€))type=â€œherdenkingâ€;
var dm=lower.match(/(\d{1,2})\s*(januari|februari|maart|april|mei|juni|juli|augustus|september|oktober|november|december)/);
var tm=lower.match(/(\d{1,2})[:.h](\d{2})/);
var dateStr=null,dateISO=null;
if(dm){var day=parseInt(dm[1]),month=MONTHS[dm[2]],year=new Date().getFullYear();var d=new Date(year,month,day);dateStr=d.toLocaleDateString(â€œnl-NLâ€,{day:â€œnumericâ€,month:â€œlongâ€});dateISO=(type===â€œverjaardagâ€||type===â€œherdenkingâ€?â€œ2000â€:year)+â€-â€+String(month+1).padStart(2,â€œ0â€)+â€-â€+String(day).padStart(2,â€œ0â€);}
var time=tm?String(tm[1]).padStart(2,â€œ0â€)+â€:â€+tm[2]:null;
var icon=type===â€œverjaardagâ€?â€\u{1F382}â€:type===â€œherdenkingâ€?â€\u{1FAF7}â€:â€\u{1F4C5}â€;
return {person,type,description:text,date:dateStr,dateISO,time,icon};
}

async function parseWithAI(text){
var today=new Date().toLocaleDateString(â€œnl-NLâ€,{weekday:â€œlongâ€,year:â€œnumericâ€,month:â€œlongâ€,day:â€œnumericâ€});
var iso=new Date().toISOString().slice(0,10);
var sys=â€œJe bent een assistent die tekst omzet naar agenda-items. Vandaag is â€œ+today+â€ (â€+iso+â€).\nDe gebruikers heten Rob en Lizet.\nGeef JSON terug (geen markdown):\n- type: afspraak, verjaardag of herdenking\n- person: rob, lizet of beide\n- description: max 80 tekens\n- date: datum als â€˜d MMMMâ€™ (zonder jaar voor verjaardagen/herdenkingen)\n- dateISO: YYYY-MM-DD voor afspraken, 2000-MM-DD voor verjaardagen/herdenkingen\n- time: HH:mm of null\n- icon: 1 emoji (ğŸ‚ verjaardag, ğŸ•¯ï¸ herdenking)\nAlleen JSON.â€;
var res=await fetch(â€œhttps://api.anthropic.com/v1/messagesâ€,{method:â€œPOSTâ€,headers:{â€œContent-Typeâ€:â€œapplication/jsonâ€},body:JSON.stringify({model:â€œclaude-sonnet-4-20250514â€,max_tokens:1000,system:sys,messages:[{role:â€œuserâ€,content:â€œZet om: "â€+text+â€"â€}]})});
var data=await res.json();var raw=data.content&&data.content[0]&&data.content[0].text;if(!raw)throw new Error(â€œleegâ€);
return JSON.parse(raw.replace(/`json|`/g,â€â€).trim());
}

async function parseFromImage(base64,mimeType){
var today=new Date().toLocaleDateString(â€œnl-NLâ€,{weekday:â€œlongâ€,year:â€œnumericâ€,month:â€œlongâ€,day:â€œnumericâ€});
var iso=new Date().toISOString().slice(0,10);
var sys=â€œJe analyseert afbeeldingen van brieven/kaarten/uitnodigingen. Vandaag is â€œ+today+â€ (â€+iso+â€).\nGeef een JSON-array terug:\n- type: afspraak, verjaardag of herdenking\n- person: rob, lizet of beide\n- description: max 80 tekens\n- date: â€˜d MMMMâ€™ of â€˜d MMMM yyyyâ€™\n- dateISO: YYYY-MM-DD of 2000-MM-DD\n- time: HH:mm of null\n- icon: passend emoji\nAlleen JSON array.â€;
var res=await fetch(â€œhttps://api.anthropic.com/v1/messagesâ€,{method:â€œPOSTâ€,headers:{â€œContent-Typeâ€:â€œapplication/jsonâ€},body:JSON.stringify({model:â€œclaude-sonnet-4-20250514â€,max_tokens:2000,system:sys,messages:[{role:â€œuserâ€,content:[{type:â€œimageâ€,source:{type:â€œbase64â€,media_type:mimeType,data:base64}},{type:â€œtextâ€,text:â€œHaal alle agenda-items uit dit document.â€}]}]})});
var data=await res.json();var raw=data.content&&data.content[0]&&data.content[0].text;if(!raw)throw new Error(â€œleegâ€);
var p=JSON.parse(raw.replace(/`json|`/g,â€â€).trim());return Array.isArray(p)?p:[p];
}

function fileToBase64(file){return new Promise(function(resolve,reject){var r=new FileReader();r.onload=function(e){resolve({base64:e.target.result.split(â€,â€)[1],mimeType:file.type||â€œimage/jpegâ€});};r.onerror=reject;r.readAsDataURL(file);});}

async function handleScan(file){
clearAlerts();previewImg.src=URL.createObjectURL(file);scanPreview.classList.add(â€œvisibleâ€);scanStatus.className=â€œscanningâ€;scanStatus.textContent=â€œBrief wordt gelezen\u2026â€;scanBtn.disabled=true;
try{var img=await fileToBase64(file);var apts=await parseFromImage(img.base64,img.mimeType);var count=0;
for(var i=0;i<apts.length;i++){var p=apts[i];if(!p.description)continue;var newRef=dbRef.push();await newRef.set({type:p.type||â€œafspraakâ€,person:p.person||â€œbeideâ€,description:p.description,date:p.date||null,dateISO:p.dateISO||null,time:p.time||null,icon:p.icon||â€\u{1F4C5}â€,createdAt:new Date().toISOString(),rawText:â€œGescandâ€});count++;}
scanStatus.className=â€â€;scanStatus.textContent=count>0?â€\u2705 â€œ+count+â€ itemâ€+(count!==1?â€œsâ€:â€â€)+â€ toegevoegd!â€:â€\u26A0\uFE0F Geen items gevonden.â€;
if(count>0)showToast(â€\u{1F4F7} â€œ+count+â€ itemâ€+(count!==1?â€œsâ€:â€â€)+â€ gescand!â€);
setTimeout(function(){scanPreview.classList.remove(â€œvisibleâ€);},4000);
}catch(e){scanStatus.className=â€â€;showAlert(alertScanErr,â€œKon de brief niet lezen. Probeer een duidelijkere foto.â€);}
finally{scanBtn.disabled=false;cameraInput.value=â€â€;}
}

async function processInput(text){
if(!text.trim()||processing)return;clearAlerts();setProcessingState(true);
try{var parsed;try{parsed=await parseWithAI(text);}catch(e){parsed=parseFallback(text);}
var newRef=dbRef.push();await newRef.set({type:parsed.type||â€œafspraakâ€,person:parsed.person||â€œbeideâ€,description:parsed.description,date:parsed.date||null,dateISO:parsed.dateISO||null,time:parsed.time||null,icon:parsed.icon||â€\u{1F4C5}â€,createdAt:new Date().toISOString(),rawText:text});
transcriptBox.style.display=â€œnoneâ€;transcriptBox.textContent=â€â€;textInput.value=â€â€;finalText=â€â€;
if(notifSupported()&&Notification.permission===â€œdefaultâ€)notifBanner.style.display=â€œflexâ€;
}catch(e){if(textMode)showAlert(alertTextErr,â€œKon niet verwerken.â€);else showAlert(alertError,â€œKon niet verwerken.â€);}
finally{setProcessingState(false);}
}

function setListeningState(v){listening=v;micRing.classList.toggle(â€œlisteningâ€,v);micBtn.classList.toggle(â€œactiveâ€,v);micBtn.textContent=v?â€\u23F9â€:(processing?â€\u2699\uFE0Fâ€:â€\u{1F3979}\uFE0Fâ€);statusText.className=v?â€œactiveâ€:(processing?â€œprocessingâ€:â€â€);statusText.textContent=v?â€œLuisteren\u2026â€:(processing?â€œVerwerken\u2026â€:â€œTik de microfoon om een afspraak in te sprekenâ€);}
function setProcessingState(v){processing=v;micBtn.classList.toggle(â€œbusyâ€,v);textSubmit.disabled=v;if(!listening){micBtn.textContent=v?â€\u2699\uFE0Fâ€:â€\u{1F3979}\uFE0Fâ€;statusText.className=v?â€œprocessingâ€:â€â€;statusText.textContent=v?â€œVerwerken\u2026â€:â€œTik de microfoon om een afspraak in te sprekenâ€;}}
function startSpeech(){var SR=window.SpeechRecognition||window.webkitSpeechRecognition;if(!SR){showAlert(alertError,â€œNiet ondersteund.â€);return;}clearAlerts();finalText=â€â€;recognition=new SR();recognition.lang=â€œnl-NLâ€;recognition.continuous=false;recognition.interimResults=true;recognition.onstart=function(){setListeningState(true);};recognition.onresult=function(e){var interim=â€â€;for(var i=e.resultIndex;i<e.results.length;i++){if(e.results[i].isFinal)finalText+=e.results[i][0].transcript;else interim+=e.results[i][0].transcript;}var d=(finalText+interim).trim();if(d){transcriptBox.textContent=â€™â€â€™+d+â€™â€â€™;transcriptBox.style.display=â€œblockâ€;}};recognition.onend=function(){setListeningState(false);if(finalText.trim())processInput(finalText.trim());};recognition.onerror=function(e){setListeningState(false);if(e.error===â€œnot-allowedâ€)alertBlocked.style.display=â€œblockâ€;else if(e.error!==â€œno-speechâ€&&e.error!==â€œabortedâ€)showAlert(alertError,â€œFout: â€œ+e.error);};recognition.start();}
function stopSpeech(){if(recognition)recognition.stop();}

function toICSDate(iso,time){if(!iso)return null;var p=iso.split(â€-â€);if(time){var t=time.split(â€:â€);return p[0]+p[1]+p[2]+â€œTâ€+t[0]+t[1]+â€œ00â€;}return p[0]+p[1]+p[2];}
function buildICS(apts){
var lines=[â€œBEGIN:VCALENDARâ€,â€œVERSION:2.0â€,â€œPRODID:-//Rob Borghouts//Onze Agenda//NLâ€,â€œCALSCALE:GREGORIANâ€,â€œMETHOD:PUBLISHâ€];
apts.forEach(function(a){var dt=toICSDate(a.dateISO,a.time);if(!dt)return;var who=a.person===â€œbeideâ€?â€œRob & Lizetâ€:a.person===â€œrobâ€?â€œRobâ€:â€œLizetâ€;
lines.push(â€œBEGIN:VEVENTâ€,â€œUID:â€+a.id+â€@onze-agendaâ€,â€œSUMMARY:â€+(a.icon||â€â€)+â€ â€œ+a.description,â€œDESCRIPTION:â€+who);
if(a.type===â€œverjaardagâ€||a.type===â€œherdenkingâ€){lines.push(â€œDTSTART;VALUE=DATE:â€+dt,â€œDTEND;VALUE=DATE:â€+dt,â€œRRULE:FREQ=YEARLYâ€);}
else if(!a.time){lines.push(â€œDTSTART;VALUE=DATE:â€+dt);var nx=new Date(a.dateISO);nx.setDate(nx.getDate()+1);var np=nx.toISOString().slice(0,10).split(â€-â€);lines.push(â€œDTEND;VALUE=DATE:â€+np[0]+np[1]+np[2]);}
else{lines.push(â€œDTSTART:â€+dt);var hp=a.time.split(â€:â€).map(Number),dp=a.dateISO.split(â€-â€);lines.push(â€œDTEND:â€+dp[0]+dp[1]+dp[2]+â€œTâ€+String(hp[0]+1).padStart(2,â€œ0â€)+String(hp[1]).padStart(2,â€œ0â€)+â€œ00â€);}
lines.push(â€œDTSTAMP:â€+new Date().toISOString().replace(/[-:.]/g,â€â€).slice(0,15)+â€œZâ€,â€œEND:VEVENTâ€);});
lines.push(â€œEND:VCALENDARâ€);return lines.join(â€\r\nâ€);
}
function downloadICS(apts,name){var blob=new Blob([buildICS(apts)],{type:â€œtext/calendar;charset=utf-8â€});var url=URL.createObjectURL(blob);var a=document.createElement(â€œaâ€);a.href=url;a.download=name;a.click();URL.revokeObjectURL(url);}

function render(){
document.getElementById(â€œcount-alleâ€).textContent=â€(â€+appointments.length+â€)â€;
document.getElementById(â€œcount-robâ€).textContent=â€(â€+appointments.filter(function(a){return a.person===â€œrobâ€&&(!a.type||a.type===â€œafspraakâ€);}).length+â€)â€;
document.getElementById(â€œcount-lizetâ€).textContent=â€(â€+appointments.filter(function(a){return a.person===â€œlizetâ€&&(!a.type||a.type===â€œafspraakâ€);}).length+â€)â€;
document.getElementById(â€œcount-bdayâ€).textContent=â€(â€+appointments.filter(function(a){return a.type===â€œverjaardagâ€;}).length+â€)â€;
document.getElementById(â€œcount-memâ€).textContent=â€(â€+appointments.filter(function(a){return a.type===â€œherdenkingâ€;}).length+â€)â€;
exportBar.style.display=appointments.length>0?â€œflexâ€:â€œnoneâ€;
var filtered;
if(activeTab===â€œalleâ€)filtered=appointments.slice();
else if(activeTab===â€œbdayâ€)filtered=appointments.filter(function(a){return a.type===â€œverjaardagâ€;});
else if(activeTab===â€œmemâ€)filtered=appointments.filter(function(a){return a.type===â€œherdenkingâ€;});
else if(activeTab===â€œrobâ€)filtered=appointments.filter(function(a){return a.person===â€œrobâ€&&(!a.type||a.type===â€œafspraakâ€);});
else if(activeTab===â€œlizetâ€)filtered=appointments.filter(function(a){return a.person===â€œlizetâ€&&(!a.type||a.type===â€œafspraakâ€);});
else filtered=appointments.slice();
var q=searchQuery.trim().toLowerCase();
if(q)filtered=filtered.filter(function(a){return(a.description||â€â€).toLowerCase().includes(q)||(a.date||â€â€).toLowerCase().includes(q)||(a.rawText||â€â€).toLowerCase().includes(q);});
filtered.sort(function(a,b){var ka=aptSortKey(a),kb=aptSortKey(b);return ka<kb?-1:ka>kb?1:0;});
if(q){searchCount.style.display=â€œblockâ€;searchCount.textContent=filtered.length===0?â€œGeen resultaten voor \u201Câ€+searchQuery+â€\u201Dâ€:filtered.length+â€ resultaatâ€+(filtered.length!==1?â€œenâ€:â€â€)+â€ voor \u201Câ€+searchQuery+â€\u201Dâ€;}else searchCount.style.display=â€œnoneâ€;
if(filtered.length===0){var icon=activeTab===â€œbdayâ€?â€ğŸ‚â€:activeTab===â€œmemâ€?â€ğŸ¨—â€:â€ğŸ™ï¸â€;var msg=activeTab===â€œbdayâ€?â€œNog geen verjaardagen. Voeg toe via spraak of tekst!â€:activeTab===â€œmemâ€?â€œNog geen herdenkingen.â€:â€œGeen afspraken. Spreek, typ of scan!â€;aptList.innerHTML=â€™<div class="empty-state"><div class="icon">â€™+icon+â€™</div><p>â€™+msg+â€™</p></div>â€™;return;}
var canNotif=notifSupported()&&Notification.permission===â€œgrantedâ€;
var html=â€â€,groupKeys=[],groups={};
filtered.forEach(function(a){var k=a.date||â€œGeen datumâ€;if(!groups[k]){groups[k]=[];groupKeys.push(k);}groups[k].push(a);});
groupKeys.forEach(function(date){
var apts=groups[date];html+=â€™<div class="section-title">â€™+escH(date)+â€™<span class="count-badge">â€™+apts.length+â€</span></div>â€;
apts.forEach(function(a){
var atype=a.type||â€œafspraakâ€;
var cardClass=atype===â€œverjaardagâ€?â€œbdayâ€:atype===â€œherdenkingâ€?â€œmemâ€:a.person;
var whoLabel=atype===â€œverjaardagâ€?â€œVerjaardagâ€:atype===â€œherdenkingâ€?â€œHerdenkingâ€:(a.person===â€œbeideâ€?â€œRob & Lizetâ€:a.person===â€œrobâ€?â€œRobâ€:â€œLizetâ€);
var whoClass=atype===â€œverjaardagâ€?â€œbdayâ€:atype===â€œherdenkingâ€?â€œmemâ€:a.person;
var expDone=exported[a.id],hasRem=reminders[a.id]!==undefined;
var calBtn=a.dateISO?â€™<button class=â€œapt-cal-btnâ€™+(expDone?â€ doneâ€:â€â€)+â€™â€ data-id=â€â€™+a.id+â€™â€>â€™+(expDone?â€âœ“â€:â€ğŸ“¥â€)+â€</button>â€:â€â€;
var bellBtn=a.dateISO&&canNotif?â€™<button class=â€œapt-bell-btnâ€™+(hasRem?â€ setâ€:â€â€)+â€™â€ data-id=â€â€™+a.id+â€™â€>ğŸ””</button>â€™:â€â€;
var yearlyBadge=atype===â€œverjaardagâ€?â€™<span class="yearly-badge">ğŸ‚ Jaarlijks</span>â€™:atype===â€œherdenkingâ€?â€™<span class="yearly-badge mem">ğŸ¨— Jaarlijks</span>â€™:â€â€;
var remBadge=hasRem?â€™<span class="reminder-badge">ğŸ”” â€˜+escH(remLabel(reminders[a.id]))+â€</span>â€:â€â€;
var popOpts=â€â€;if(a.dateISO&&canNotif){REM_OPTS.forEach(function(o){var act=reminders[a.id]===o.mins;popOpts+=â€™<button class=â€œreminder-optâ€™+(act?â€ activeâ€:â€â€)+â€™â€ data-id=â€â€™+a.id+â€™â€ data-mins=â€â€™+o.mins+â€™â€>â€™+escH(o.label)+(act?â€ âœ“â€:â€â€)+â€</button>â€;});if(hasRem)popOpts+=â€™<button class="reminder-opt cancel" data-id="'+a.id+'" data-mins="cancel">âœ• Verwijder herinnering</button>â€™;}
var pop=a.dateISO&&canNotif?â€™<div class="reminder-popover" id="pop-'+a.id+'"><p>Herinnering</p>â€™+popOpts+â€</div>â€:â€â€;
html+=â€™<div class="apt-card '+cardClass+'" style="margin-bottom:8px" data-id="'+a.id+'">â€™
+â€™<div class="apt-icon">â€™+(a.icon||â€ğŸ“…â€)+â€</div>â€
+â€™<div class="apt-body"><div class="apt-who '+whoClass+'">â€™+escH(whoLabel)+â€</div>â€
+â€™<div class="apt-desc">â€™+highlight(a.description,searchQuery.trim())+â€</div>â€
+â€™<div class="apt-meta">â€™+(a.time?â€™<span>ğŸ• â€˜+escH(a.time)+â€</span>â€:â€â€)+yearlyBadge+remBadge+â€</div></div>â€
+â€™<div class="apt-actions">â€™+calBtn+bellBtn+pop+â€™<button class="apt-del-btn" data-id="'+a.id+'">ğŸ—‘</button></div></div>â€™;
});
});
aptList.innerHTML=html;
}

function closeAllPopovers(){document.querySelectorAll(â€.reminder-popover.openâ€).forEach(function(p){p.classList.remove(â€œopenâ€);});openPopover=null;}

notifAllowBtn.addEventListener(â€œclickâ€,requestNotifPermission);
notifDismiss.addEventListener(â€œclickâ€,function(){notifBanner.style.display=â€œnoneâ€;});
micBtn.addEventListener(â€œclickâ€,function(){if(processing)return;if(listening)stopSpeech();else startSpeech();});
scanBtn.addEventListener(â€œclickâ€,function(){cameraInput.click();});
cameraInput.addEventListener(â€œchangeâ€,function(e){var f=e.target.files&&e.target.files[0];if(f)handleScan(f);});
modeToggle.addEventListener(â€œclickâ€,function(){textMode=!textMode;clearAlerts();if(textMode){textSection.classList.add(â€œvisibleâ€);modeToggle.textContent=â€\u{1F3979}\uFE0F Terug naar spraakopnameâ€;micRing.style.display=â€œnoneâ€;statusText.style.display=â€œnoneâ€;}else{textSection.classList.remove(â€œvisibleâ€);modeToggle.textContent=â€\u2B00\uFE0F Liever typen? Gebruik tekstinvoerâ€;micRing.style.display=â€â€;statusText.style.display=â€â€;}});
textSubmit.addEventListener(â€œclickâ€,function(){processInput(textInput.value);});
textInput.addEventListener(â€œkeydownâ€,function(e){if(e.key===â€œEnterâ€)processInput(textInput.value);});
searchInput.addEventListener(â€œinputâ€,function(){searchQuery=searchInput.value;searchClear.style.display=searchQuery?â€œblockâ€:â€œnoneâ€;render();});
searchClear.addEventListener(â€œclickâ€,function(){searchInput.value=â€â€;searchQuery=â€â€;searchClear.style.display=â€œnoneâ€;searchInput.focus();render();});
document.querySelectorAll(â€.tabâ€).forEach(function(btn){btn.addEventListener(â€œclickâ€,function(){document.querySelectorAll(â€.tabâ€).forEach(function(t){t.classList.remove(â€œactiveâ€);});btn.classList.add(â€œactiveâ€);activeTab=btn.dataset.tab;render();});});
exportAllBtn.addEventListener(â€œclickâ€,function(){var wd=appointments.filter(function(a){return a.dateISO;});if(!wd.length){alert(â€œGeen items met datum.â€);return;}downloadICS(wd,â€œonze-agenda.icsâ€);});
aptList.addEventListener(â€œclickâ€,function(e){
var del=e.target.closest(â€.apt-del-btnâ€),cal=e.target.closest(â€.apt-cal-btnâ€),bell=e.target.closest(â€.apt-bell-btnâ€),opt=e.target.closest(â€.reminder-optâ€);
if(del){cancelReminder(del.dataset.id);dbRef.child(del.dataset.id).remove();return;}
if(cal){var apt=appointments.find(function(a){return a.id===cal.dataset.id;});if(!apt)return;downloadICS([apt],apt.description.slice(0,30).replace(/\s/g,â€-â€)+â€.icsâ€);exported[cal.dataset.id]=true;render();return;}
if(bell){e.stopPropagation();var pop=document.getElementById(â€œpop-â€+bell.dataset.id);if(!pop)return;if(pop.classList.contains(â€œopenâ€)){pop.classList.remove(â€œopenâ€);openPopover=null;}else{closeAllPopovers();pop.classList.add(â€œopenâ€);openPopover=bell.dataset.id;}return;}
if(opt){e.stopPropagation();var apt2=appointments.find(function(a){return a.id===opt.dataset.id;});if(!apt2)return;closeAllPopovers();if(opt.dataset.mins===â€œcancelâ€){cancelReminder(opt.dataset.id);showToast(â€ğŸ”” Herinnering verwijderdâ€);}else{setReminder(apt2,parseInt(opt.dataset.mins));showToast(â€ğŸ”” Herinnering ingesteld: â€œ+remLabel(parseInt(opt.dataset.mins)));}render();return;}
closeAllPopovers();
});
document.addEventListener(â€œclickâ€,function(e){if(!e.target.closest(â€.apt-actionsâ€))closeAllPopovers();});

checkNotifBanner();
</script>

</body>
</html>