<!DOCTYPE html>

<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>Onze Agenda â€“ Rob &amp; Lizet</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg:           #fdf8ee;
      --surface:      #f0e8d5;
      --card:         #e5d8be;
      --rob:          #1a5fa8;
      --rob-bg:       rgba(26,95,168,0.10);
      --rob-border:   rgba(26,95,168,0.40);
      --lizet:        #8b3a6b;
      --lizet-bg:     rgba(139,58,107,0.10);
      --lizet-border: rgba(139,58,107,0.40);
      --beide:        #3a6b4a;
      --beide-bg:     rgba(58,107,74,0.10);
      --beide-border: rgba(58,107,74,0.35);
      --text:         #1c1917;
      --muted:        #78716c;
      --border:       rgba(0,0,0,0.12);
      --bday:        #b45309;
      --bday-bg:     rgba(180,83,9,0.10);
      --bday-border: rgba(180,83,9,0.40);
      --mem:         #6b4fa8;
      --mem-bg:      rgba(107,79,168,0.10);
      --mem-border:  rgba(107,79,168,0.40);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; min-height: 100vh; -webkit-tap-highlight-color: transparent; }
    #app { max-width: 720px; margin: 0 auto; padding: 36px 20px 80px; }
    .header { text-align: center; margin-bottom: 48px; }
    .header h1 { font-family:'Playfair Display',serif; font-size:2.6rem; letter-spacing:-0.5px; background:linear-gradient(135deg,var(--rob) 0%,var(--lizet) 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom:10px; }
    .header-names { display:flex; justify-content:center; gap:14px; margin-bottom:8px; }
    .name-pill { padding:4px 16px; border-radius:20px; font-size:0.8rem; font-weight:500; }
    .name-pill.rob   { background:var(--rob-bg);   border:1px solid var(--rob-border);   color:var(--rob); }
    .name-pill.lizet { background:var(--lizet-bg); border:1px solid var(--lizet-border); color:var(--lizet); }
    .header p { color:var(--muted); font-size:0.85rem; font-weight:300; }
    .mic-section { display:flex; flex-direction:column; align-items:center; gap:18px; margin-bottom:40px; }
    .mic-ring { position:relative; width:100px; height:100px; flex-shrink:0; }
    .mic-ring::before { content:''; position:absolute; inset:-6px; border-radius:50%; background:conic-gradient(var(--rob),var(--lizet),var(--rob)); opacity:0; transition:opacity 0.4s; }
    .mic-ring.listening::before { opacity:1; animation:ringRotate 2s linear infinite; }
    .mic-ring::after { content:''; position:absolute; inset:-3px; border-radius:50%; background:var(--bg); opacity:0; transition:opacity 0.4s; }
    .mic-ring.listening::after { opacity:1; }
    @keyframes ringRotate { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
    #mic-btn { position:relative; z-index:1; width:100px; height:100px; border-radius:50%; border:2px solid var(--border); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:2rem; background:var(--surface); transition:all 0.3s ease; -webkit-appearance:none; }
    #mic-btn:hover  { transform:scale(1.05); border-color:var(--rob); }
    #mic-btn.active { background:linear-gradient(135deg,rgba(26,95,168,.12),rgba(139,58,107,.12)); border-color:transparent; box-shadow:0 0 30px rgba(26,95,168,.15); }
    #mic-btn.busy   { background:var(--beide-bg); border-color:var(--beide); animation:spinGlow 1.5s infinite; }
    @keyframes spinGlow { 0%,100%{box-shadow:0 0 20px rgba(58,107,74,.2)} 50%{box-shadow:0 0 40px rgba(58,107,74,.4)} }
    #status-text { font-size:0.85rem; color:var(--muted); text-align:center; min-height:20px; transition:color .3s; }
    #status-text.active     { color:var(--rob); }
    #status-text.processing { color:var(--beide); }
    #transcript-box { display:none; width:100%; background:var(--surface); border:1px solid var(--border); border-radius:14px; padding:14px 18px; font-size:0.93rem; font-style:italic; color:var(--text); line-height:1.5; }
    .alert { display:none; width:100%; border-radius:12px; padding:13px 16px; font-size:0.83rem; line-height:1.55; }
    .alert.error { background:rgba(220,38,38,.10); border:1px solid rgba(220,38,38,.30); color:#b91c1c; text-align:center; }
    .alert.warn  { background:rgba(180,83,9,.08);  border:1px solid rgba(180,83,9,.25);  color:#92400e; }
    .alert.warn strong { font-weight:600; display:block; margin-bottom:4px; }
    #text-section { display:none; width:100%; flex-direction:column; gap:10px; }
    #text-section.visible { display:flex; animation:slideIn .3s ease; }
    #text-hint { font-size:0.8rem; color:var(--muted); text-align:center; }
    .text-row { display:flex; gap:8px; }
    #text-input { flex:1; background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:12px 16px; font-family:'DM Sans',sans-serif; font-size:0.95rem; color:var(--text); outline:none; transition:border-color .2s; -webkit-appearance:none; }
    #text-input::placeholder { color:var(--muted); }
    #text-input:focus { border-color:var(--rob); }
    #text-submit { background:var(--rob-bg); border:1px solid var(--rob-border); color:var(--rob); border-radius:12px; padding:12px 18px; font-family:'DM Sans',sans-serif; font-size:1.1rem; cursor:pointer; transition:all .2s; flex-shrink:0; }
    #text-submit:hover   { background:rgba(26,95,168,.20); }
    #text-submit:disabled{ opacity:.4; cursor:not-allowed; }
    .mode-toggle { font-size:0.78rem; color:var(--muted); cursor:pointer; text-decoration:underline; text-underline-offset:3px; background:none; border:none; font-family:'DM Sans',sans-serif; padding:0; }
    .mode-toggle:hover { color:var(--text); }
    .tabs { display:flex; gap:6px; margin-bottom:28px; background:var(--surface); border-radius:14px; padding:5px; border:1px solid var(--border); }
    .tab { flex:1; padding:10px 8px; border:1px solid transparent; border-radius:10px; cursor:pointer; font-family:'DM Sans',sans-serif; font-size:0.875rem; font-weight:500; background:transparent; color:var(--muted); transition:all .22s; }
    .tab:hover { color:var(--text); }
    .tab[data-tab="alle"].active  { background:var(--bg);       color:var(--text);   border-color:var(--border); box-shadow:0 1px 4px rgba(0,0,0,.08); }
    .tab[data-tab="rob"].active   { background:var(--rob-bg);   color:var(--rob);    border-color:var(--rob-border); }
    .tab[data-tab="lizet"].active { background:var(--lizet-bg); color:var(--lizet);  border-color:var(--lizet-border); }
    .tab[data-tab="bday"].active  { background:var(--bday-bg);   color:var(--bday);   border-color:var(--bday-border); }
    .tab[data-tab="mem"].active   { background:var(--mem-bg);    color:var(--mem);    border-color:var(--mem-border); }
    #export-bar { display:none; align-items:center; justify-content:space-between; gap:12px; background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:12px 16px; margin-bottom:16px; }
    #export-bar p { font-size:0.82rem; color:var(--muted); line-height:1.4; }
    #export-all-btn { background:var(--rob-bg); border:1px solid var(--rob-border); color:var(--rob); border-radius:8px; padding:8px 14px; font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:500; cursor:pointer; white-space:nowrap; flex-shrink:0; transition:all .2s; }
    #export-all-btn:hover { background:rgba(26,95,168,.20); transform:translateY(-1px); }
    #apt-list { display:flex; flex-direction:column; gap:8px; }
    .section-title { font-size:0.8rem; font-weight:600; text-transform:uppercase; letter-spacing:.1em; color:var(--muted); margin:24px 0 10px; display:flex; align-items:center; gap:10px; }
    .section-title::after { content:''; flex:1; height:1px; background:var(--border); }
    .count-badge { background:var(--card); border-radius:20px; padding:1px 9px; font-size:.75rem; font-weight:500; color:var(--muted); }
    .apt-card { border-radius:14px; padding:16px 18px; display:flex; align-items:flex-start; gap:14px; border:1px solid; transition:transform .2s,box-shadow .2s; animation:slideIn .3s ease; }
    .apt-card:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,0,0,.12); }
    .apt-card.rob   { background:rgba(26,95,168,.07);  border-color:var(--rob-border); }
    .apt-card.lizet { background:rgba(139,58,107,.07); border-color:var(--lizet-border); }
    .apt-card.beide { background:rgba(58,107,74,.07);  border-color:var(--beide-border); }
    .apt-card.bday  { background:rgba(180,83,9,.07);   border-color:var(--bday-border); }
    .apt-card.mem   { background:rgba(107,79,168,.07);  border-color:var(--mem-border); }
    @keyframes slideIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
    .apt-icon { font-size:1.3rem; flex-shrink:0; margin-top:2px; }
    .apt-body { flex:1; min-width:0; }
    .apt-who { font-size:.7rem; font-weight:600; text-transform:uppercase; letter-spacing:.1em; margin-bottom:4px; }
    .apt-who.rob   { color:var(--rob); }
    .apt-who.lizet { color:var(--lizet); }
    .apt-who.beide { color:var(--beide); }
    .apt-who.bday  { color:var(--bday); }
    .apt-who.mem   { color:var(--mem); }
    .apt-desc { font-size:.975rem; margin-bottom:6px; line-height:1.4; color:var(--text); }
    .apt-meta { font-size:.78rem; color:var(--muted); display:flex; gap:12px; flex-wrap:wrap; }
    .apt-actions { display:flex; gap:4px; flex-shrink:0; align-items:flex-start; }
    .apt-cal-btn,.apt-del-btn { background:none; border:none; cursor:pointer; font-size:.95rem; padding:4px 6px; border-radius:6px; transition:all .2s; opacity:.4; color:var(--muted); }
    .apt-card:hover .apt-cal-btn,
    .apt-card:hover .apt-del-btn { opacity:1; }
    .apt-cal-btn:hover { background:var(--rob-bg); color:var(--rob); }
    .apt-cal-btn.done  { color:#2d7a46; opacity:1 !important; }
    .apt-del-btn:hover { background:rgba(220,38,38,.10); color:#b91c1c; }
    .empty-state { text-align:center; padding:60px 20px; color:var(--muted); }
    .empty-state .icon { font-size:2.5rem; margin-bottom:12px; }
    .empty-state p { font-size:.88rem; font-weight:300; line-height:1.6; }
    .footer { text-align:center; margin-top:56px; padding-top:20px; border-top:1px solid var(--border); font-size:.75rem; color:var(--muted); font-weight:300; letter-spacing:.04em; }
    .footer span { background:linear-gradient(90deg,var(--rob),var(--lizet)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; font-weight:500; }
  </style>
</head>
<body>
<div id="app">
  <div class="header">
    <h1>Onze Agenda</h1>
    <div class="header-names">
      <span class="name-pill rob">&#128100; Rob</span>
      <span class="name-pill lizet">&#128105; Lizet</span>
    </div>
    <p>Spreek of typ je afspraken in</p>
  </div>
  <div class="mic-section">
    <div class="mic-ring" id="mic-ring">
      <button id="mic-btn" title="Start opname">&#127897;&#65039;</button>
    </div>
    <div id="status-text">Tik de microfoon om een afspraak in te spreken</div>
    <div id="transcript-box"></div>
    <div class="alert warn" id="alert-blocked">
      <strong>&#128274; Microfoon geblokkeerd</strong>
      Safari staat de microfoon niet toe. Oplossing:<br>
      1. Ga naar <strong>Instellingen &rarr; Safari &rarr; Microfoon</strong> &rarr; Toestaan<br>
      2. Herlaad de pagina en probeer opnieuw<br>
      3. Of gebruik de tekstinvoer hieronder &darr;
    </div>
    <div class="alert error" id="alert-error"></div>
    <div id="text-section">
      <div id="text-hint">Typ je afspraak &mdash; bv. "Vrijdag 14 maart om 10:00 tandarts voor Rob"</div>
      <div class="text-row">
        <input id="text-input" type="text" placeholder="Afspraak beschrijving..." autocomplete="off" />
        <button id="text-submit">&#10133;</button>
      </div>
      <div class="alert error" id="alert-text-error"></div>
    </div>
    <button class="mode-toggle" id="mode-toggle">&#9000;&#65039; Liever typen? Gebruik tekstinvoer</button>
  </div>
  <div class="tabs">
    <button class="tab active" data-tab="alle">&#128467; Alle <span id="count-alle">(0)</span></button>
    <button class="tab" data-tab="rob">&#128100; Rob <span id="count-rob">(0)</span></button>
    <button class="tab" data-tab="lizet">&#128105; Lizet <span id="count-lizet">(0)</span></button>
    <button class="tab" data-tab="bday">&#127874; Jarig <span id="count-bday">(0)</span></button>
    <button class="tab" data-tab="mem">&#128367; Herdenking <span id="count-mem">(0)</span></button>
  </div>
  <div id="export-bar">
    <p>&#128197; Exporteer als .ics &mdash; werkt met Apple Agenda, Google Agenda &amp; Outlook.</p>
    <button id="export-all-btn">Alles exporteren</button>
  </div>
  <div id="apt-list">
    <div class="empty-state">
      <div class="icon">&#127897;&#65039;</div>
      <p>Geen afspraken. Spreek of typ een afspraak in!</p>
      <p style="margin-top:8px">Bv: "Woensdag 5 maart om 14:00 tandarts voor Lizet"</p>
    </div>
  </div>
  <div class="footer"><span>Made by Rob Borghouts</span> &middot; 2026</div>
</div>
<script>
var STORAGE_KEY="afspraken_v3";
var appointments=[];
var activeTab="alle";
var textMode=false;
var listening=false;
var processing=false;
var recognition=null;
var finalText="";
var exported={};
try{appointments=JSON.parse(localStorage.getItem(STORAGE_KEY))||[];}catch(e){}

var micRing=document.getElementById(â€œmic-ringâ€);
var micBtn=document.getElementById(â€œmic-btnâ€);
var statusText=document.getElementById(â€œstatus-textâ€);
var transcriptBox=document.getElementById(â€œtranscript-boxâ€);
var alertBlocked=document.getElementById(â€œalert-blockedâ€);
var alertError=document.getElementById(â€œalert-errorâ€);
var textSection=document.getElementById(â€œtext-sectionâ€);
var textInput=document.getElementById(â€œtext-inputâ€);
var textSubmit=document.getElementById(â€œtext-submitâ€);
var alertTextErr=document.getElementById(â€œalert-text-errorâ€);
var modeToggle=document.getElementById(â€œmode-toggleâ€);
var aptList=document.getElementById(â€œapt-listâ€);
var exportBar=document.getElementById(â€œexport-barâ€);
var exportAllBtn=document.getElementById(â€œexport-all-btnâ€);

var MONTHS={januari:0,februari:1,maart:2,april:3,mei:4,juni:5,juli:6,augustus:7,september:8,oktober:9,november:10,december:11};

function save(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(appointments));}catch(e){}}
function showAlert(el,msg){el.innerHTML=msg||â€â€;el.style.display=msg?â€œblockâ€:â€œnoneâ€;}
function clearAlerts(){showAlert(alertBlocked,â€â€);showAlert(alertError,â€â€);showAlert(alertTextErr,â€â€);}

function parseFallback(text){
var lower=text.toLowerCase();
var person=â€œbeideâ€;
var hasLizet=lower.includes(â€œlizetâ€);
var hasRob=lower.includes(â€œrobâ€);
if(hasLizet&&!hasRob)person=â€œlizetâ€;
else if(hasRob&&!hasLizet)person=â€œrobâ€;
var dateMatch=lower.match(/(\d{1,2})\s*(januari|februari|maart|april|mei|juni|juli|augustus|september|oktober|november|december)/);
var timeMatch=lower.match(/(\d{1,2})[:.h](\d{2})/);
var dateStr=null,dateISO=null;
if(dateMatch){
var day=parseInt(dateMatch[1]);
var month=MONTHS[dateMatch[2]];
var year=new Date().getFullYear();
var d=new Date(year,month,day);
dateStr=d.toLocaleDateString(â€œnl-NLâ€,{day:â€œnumericâ€,month:â€œlongâ€,year:â€œnumericâ€});
dateISO=year+â€-â€+String(month+1).padStart(2,â€œ0â€)+â€-â€+String(day).padStart(2,â€œ0â€);
}
var time=timeMatch?String(timeMatch[1]).padStart(2,â€œ0â€)+â€:â€+timeMatch[2]:null;
var type=â€œafspraakâ€;
if(lower.includes(â€œverjaardagâ€)||lower.includes(â€œjarigâ€))type=â€œverjaardagâ€;
else if(lower.includes(â€œherdenkâ€)||lower.includes(â€œoverlijdenâ€)||lower.includes(â€œoverleedâ€)||lower.includes(â€œgestorvenâ€))type=â€œherdenkingâ€;
var icon=type===â€œverjaardagâ€?â€ğŸ‚â€:type===â€œherdenkingâ€?â€ğŸ•¯â€:â€ğŸ“…â€;
return{type:type,person:person,description:text,date:dateStr,dateISO:dateISO,time:time,icon:icon};
}

async function parseWithAI(text){
var today=new Date().toLocaleDateString(â€œnl-NLâ€,{weekday:â€œlongâ€,year:â€œnumericâ€,month:â€œlongâ€,day:â€œnumericâ€});
var todayISO=new Date().toISOString().slice(0,10);
var res=await fetch(â€œhttps://api.anthropic.com/v1/messagesâ€,{
method:â€œPOSTâ€,
headers:{â€œContent-Typeâ€:â€œapplication/jsonâ€},
body:JSON.stringify({
model:â€œclaude-sonnet-4-20250514â€,
max_tokens:1000,
system:â€œJe bent een assistent die gesproken tekst omzet naar agenda-items. Vandaag is het â€œ+today+â€ (â€+todayISO+â€).\nDe gebruikers heten Rob en Lizet.\nGeef altijd JSON terug (geen markdown), met deze velden:\n- type: "afspraak" of "verjaardag"\n- person: "rob", "lizet", of "beide"\n- description: korte beschrijving (max 80 tekens)\n- date: datum als "d MMMM yyyy" in het Nederlands (zonder jaar voor verjaardagen), of null\n- dateISO: datum als "YYYY-MM-DD" voor afspraken, "2000-MM-DD" voor verjaardagen, of null\n- time: tijd als "HH:mm", of null\n- icon: 1 passend emoji (gebruik \uD83C\uDF82 voor verjaardagen)\nGeef ALLEEN de JSON terug, niets anders.â€,
messages:[{role:â€œuserâ€,content:â€œZet deze tekst om naar een afspraak: "â€+text+â€"â€}]
})
});
var data=await res.json();
var raw=data.content&&data.content[0]&&data.content[0].text;
if(!raw)throw new Error(â€œgeen responseâ€);
return JSON.parse(raw.replace(/`json|`/g,â€â€).trim());
}

function setListeningState(val){
listening=val;
micRing.classList.toggle(â€œlisteningâ€,val);
micBtn.classList.toggle(â€œactiveâ€,val);
micBtn.textContent=val?â€œâ¹â€:(processing?â€œâš™ï¸â€:â€œğŸ™ï¸â€);
statusText.className=val?â€œactiveâ€:(processing?â€œprocessingâ€:â€â€);
statusText.textContent=val?â€œLuisterenâ€¦ spreek uw afspraak inâ€:(processing?â€œVerwerkenâ€¦â€:â€œTik de microfoon om een afspraak in te sprekenâ€);
}

function setProcessingState(val){
processing=val;
micBtn.classList.toggle(â€œbusyâ€,val);
textSubmit.disabled=val;
if(!listening){
micBtn.textContent=val?â€œâš™ï¸â€:â€œğŸ™ï¸â€;
statusText.className=val?â€œprocessingâ€:â€â€;
statusText.textContent=val?â€œVerwerkenâ€¦â€:â€œTik de microfoon om een afspraak in te sprekenâ€;
}
}

async function processInput(text){
if(!text.trim()||processing)return;
clearAlerts();
setProcessingState(true);
try{
var parsed;
try{parsed=await parseWithAI(text);}catch(e){parsed=parseFallback(text);}
var apt=Object.assign({},parsed,{id:Date.now(),createdAt:new Date().toISOString(),rawText:text});
appointments.unshift(apt);
save();
render();
transcriptBox.style.display=â€œnoneâ€;
transcriptBox.textContent=â€â€;
textInput.value=â€â€;
finalText=â€â€;
}catch(e){
if(textMode)showAlert(alertTextErr,â€œKon de afspraak niet verwerken. Probeer opnieuw.â€);
else showAlert(alertError,â€œKon de afspraak niet verwerken. Probeer opnieuw.â€);
}finally{
setProcessingState(false);
}
}

function startSpeech(){
var SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR){showAlert(alertError,â€œSpraakherkenning niet ondersteund. Gebruik de tekstinvoer.â€);return;}
clearAlerts();
finalText=â€â€;
recognition=new SR();
recognition.lang=â€œnl-NLâ€;
recognition.continuous=false;
recognition.interimResults=true;
recognition.onstart=function(){setListeningState(true);};
recognition.onresult=function(e){
var interim=â€â€;
for(var i=e.resultIndex;i<e.results.length;i++){
if(e.results[i].isFinal)finalText+=e.results[i][0].transcript;
else interim+=e.results[i][0].transcript;
}
var display=(finalText+interim).trim();
if(display){transcriptBox.textContent=â€™â€â€™+display+â€™â€â€™;transcriptBox.style.display=â€œblockâ€;}
};
recognition.onend=function(){
setListeningState(false);
if(finalText.trim())processInput(finalText.trim());
};
recognition.onerror=function(e){
setListeningState(false);
if(e.error===â€œnot-allowedâ€)alertBlocked.style.display=â€œblockâ€;
else if(e.error!==â€œno-speechâ€)showAlert(alertError,â€œFout: â€œ+e.error);
};
recognition.start();
}

function stopSpeech(){if(recognition)recognition.stop();}

function toICSDate(iso,time){
if(!iso)return null;
var parts=iso.split(â€-â€);
if(time){var tp=time.split(â€:â€);return parts[0]+parts[1]+parts[2]+â€œTâ€+tp[0]+tp[1]+â€œ00â€;}
return parts[0]+parts[1]+parts[2];
}

function buildICS(apts){
var lines=[â€œBEGIN:VCALENDARâ€,â€œVERSION:2.0â€,â€œPRODID:-//Rob Borghouts//Onze Agenda//NLâ€,â€œCALSCALE:GREGORIANâ€,â€œMETHOD:PUBLISHâ€];
apts.forEach(function(a){
var dt=toICSDate(a.dateISO,a.time);
if(!dt)return;
var who=a.person===â€œbeideâ€?â€œRob & Lizetâ€:a.person===â€œrobâ€?â€œRobâ€:â€œLizetâ€;
lines.push(â€œBEGIN:VEVENTâ€,â€œUID:â€+a.id+â€@onze-agendaâ€,â€œSUMMARY:â€+(a.icon||â€â€)+â€ â€œ+a.description,â€œDESCRIPTION:Afspraak voor â€œ+who);
if(!a.time){
lines.push(â€œDTSTART;VALUE=DATE:â€+dt);
var next=new Date(a.dateISO);next.setDate(next.getDate()+1);
var np=next.toISOString().slice(0,10).split(â€-â€);
lines.push(â€œDTEND;VALUE=DATE:â€+np[0]+np[1]+np[2]);
}else{
lines.push(â€œDTSTART:â€+dt);
var hp=a.time.split(â€:â€).map(Number);
var dp=a.dateISO.split(â€-â€);
lines.push(â€œDTEND:â€+dp[0]+dp[1]+dp[2]+â€œTâ€+String(hp[0]+1).padStart(2,â€œ0â€)+String(hp[1]).padStart(2,â€œ0â€)+â€œ00â€);
}
lines.push(â€œDTSTAMP:â€+new Date().toISOString().replace(/[-:.]/g,â€â€).slice(0,15)+â€œZâ€,â€œEND:VEVENTâ€);
});
lines.push(â€œEND:VCALENDARâ€);
return lines.join(â€\r\nâ€);
}

function downloadICS(apts,name){
var blob=new Blob([buildICS(apts)],{type:â€œtext/calendar;charset=utf-8â€});
var url=URL.createObjectURL(blob);
var a=document.createElement(â€œaâ€);
a.href=url;a.download=name;a.click();
URL.revokeObjectURL(url);
}

function escH(str){
return String(str).replace(/&/g,â€&â€).replace(/</g,â€<â€).replace(/>/g,â€>â€).replace(/â€/g,â€"â€);
}

function render(){
document.getElementById(â€œcount-alleâ€).textContent=â€(â€+appointments.length+â€)â€;
document.getElementById(â€œcount-robâ€).textContent=â€(â€+appointments.filter(function(a){return a.person===â€œrobâ€;}).length+â€)â€;
document.getElementById(â€œcount-lizetâ€).textContent=â€(â€+appointments.filter(function(a){return a.person===â€œlizetâ€;}).length+â€)â€;
document.getElementById(â€œcount-bdayâ€).textContent=â€(â€+appointments.filter(function(a){return a.type===â€œverjaardagâ€;}).length+â€)â€;
document.getElementById(â€œcount-memâ€).textContent=â€(â€+appointments.filter(function(a){return a.type===â€œherdenkingâ€;}).length+â€)â€;
exportBar.style.display=appointments.length>0?â€œflexâ€:â€œnoneâ€;
var filtered=activeTab===â€œbdayâ€?appointments.filter(function(a){return a.type===â€œverjaardagâ€;}):activeTab===â€œmemâ€?appointments.filter(function(a){return a.type===â€œherdenkingâ€;}):activeTab===â€œalleâ€?appointments:appointments.filter(function(a){return a.person===activeTab&&a.type!==â€œverjaardagâ€&&a.type!==â€œherdenkingâ€;});
var groups={};
filtered.forEach(function(a){var k=a.date||â€œGeen datumâ€;if(!groups[k])groups[k]=[];groups[k].push(a);});
if(filtered.length===0){
aptList.innerHTML=â€™<div class="empty-state"><div class="icon">ğŸ™ï¸</div><p>Geen afspraken. Spreek of typ een afspraak in!</p><p style="margin-top:8px">Bv: â€œWoensdag 5 maart om 14:00 tandarts voor Lizetâ€</p></div>â€™;
return;
}
var html=â€â€;
Object.keys(groups).forEach(function(date){
var apts=groups[date];
html+=â€™<div class="section-title">â€™+escH(date)+â€™<span class="count-badge">â€™+apts.length+â€</span></div>â€;
apts.forEach(function(a){
var expDone=exported[a.id];
var calBtn=a.dateISO?â€™<button class=â€œapt-cal-btnâ€™+(expDone?â€ doneâ€:â€â€)+â€™â€ data-id=â€â€™+a.id+â€™â€ title=â€œExporteer naar agendaâ€>â€™+(expDone?â€âœ“â€:â€ğŸ“¥â€)+â€</button>â€:â€â€;
var cardClass=a.type===â€œverjaardagâ€?â€œbdayâ€:a.type===â€œherdenkingâ€?â€œmemâ€:a.person;
var whoLabel=a.type===â€œverjaardagâ€?â€œVerjaardagâ€:a.type===â€œherdenkingâ€?â€œHerdenkingâ€:(a.person===â€œbeideâ€?â€œRob & Lizetâ€:a.person===â€œrobâ€?â€œRobâ€:â€œLizetâ€);
html+=â€™<div class="apt-card '+cardClass+'" style="margin-bottom:8px" data-id="'+a.id+'">â€™;
+â€™<div class="apt-icon">â€™+(a.icon||â€ğŸ“…â€)+â€</div>â€
+â€™<div class="apt-body">â€™
+â€™<div class="apt-who '+cardClass+'">â€™+escH(whoLabel)+â€</div>â€
+â€™<div class="apt-desc">â€™+escH(a.description)+â€</div>â€
+â€™<div class="apt-meta">â€™
+(a.time?â€™<span>ğŸ• â€˜+escH(a.time)+â€</span>â€:â€â€)
+â€™<span>Toegevoegd: â€˜+new Date(a.createdAt).toLocaleTimeString(â€œnl-NLâ€,{hour:â€œ2-digitâ€,minute:â€œ2-digitâ€})+â€</span>â€
+â€</div></div>â€
+â€™<div class="apt-actions">â€™+calBtn+â€™<button class="apt-del-btn" data-id="'+a.id+'" title="Verwijder">ğŸ—‘</button></div>â€™
+â€</div>â€;
});
});
aptList.innerHTML=html;
}

micBtn.addEventListener(â€œclickâ€,function(){
if(processing)return;
if(listening)stopSpeech();
else startSpeech();
});

modeToggle.addEventListener(â€œclickâ€,function(){
textMode=!textMode;
clearAlerts();
if(textMode){
textSection.classList.add(â€œvisibleâ€);
modeToggle.textContent=â€ğŸ™ï¸ Terug naar spraakopnameâ€;
micRing.style.display=â€œnoneâ€;
statusText.style.display=â€œnoneâ€;
}else{
textSection.classList.remove(â€œvisibleâ€);
modeToggle.textContent=â€âŒ¨ï¸ Liever typen? Gebruik tekstinvoerâ€;
micRing.style.display=â€â€;
statusText.style.display=â€â€;
}
});

textSubmit.addEventListener(â€œclickâ€,function(){processInput(textInput.value);});
textInput.addEventListener(â€œkeydownâ€,function(e){if(e.key===â€œEnterâ€)processInput(textInput.value);});

document.querySelectorAll(â€.tabâ€).forEach(function(btn){
btn.addEventListener(â€œclickâ€,function(){
document.querySelectorAll(â€.tabâ€).forEach(function(t){t.classList.remove(â€œactiveâ€);});
btn.classList.add(â€œactiveâ€);
activeTab=btn.dataset.tab;
render();
});
});

exportAllBtn.addEventListener(â€œclickâ€,function(){
var withDate=appointments.filter(function(a){return a.dateISO;});
if(!withDate.length){alert(â€œGeen afspraken met een datum.â€);return;}
downloadICS(withDate,â€œonze-agenda.icsâ€);
});

aptList.addEventListener(â€œclickâ€,function(e){
var delBtn=e.target.closest(â€.apt-del-btnâ€);
var calBtn=e.target.closest(â€.apt-cal-btnâ€);
if(delBtn){
var id=parseInt(delBtn.dataset.id);
appointments=appointments.filter(function(a){return a.id!==id;});
save();render();
}
if(calBtn){
var id2=parseInt(calBtn.dataset.id);
var apt=appointments.find(function(a){return a.id===id2;});
if(!apt)return;
downloadICS([apt],apt.description.slice(0,30).replace(/\s/g,â€-â€)+â€.icsâ€);
exported[id2]=true;render();
}
});

render();
</script>

</body>
</html>